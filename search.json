---
---
[
  {% for collection in site.collections %}
  {% assign outer_last_idx = forloop.length %}
    {% assign outer_idx = forloop.index %}
    {% for post in site[collection.label] %}
      {% assign inner_last_idx = forloop.length %}
      {% assign inner_idx = forloop.index %}
      {
        "title"     : "{{ post.title | escape }}",
        "collection": "{{ collection.title }}",
        "url"       : "{{ site.baseurl }}{{ post.url }}",
        "category"  : "{{ post.category }}",
        "tags"      : "{{ post.tags | join: ', ' }}",
        "date"      : "{{ post.date }}",
        "content": {{ post.content | strip_html | strip_newlines | escape | jsonify}}
      }{% unless outer_idx == outer_last_idx and inner_idx == inner_last_idx %},{% endunless %}
    {% endfor %}
  {% endfor %}
]
